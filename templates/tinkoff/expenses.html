{% extends "tinkoff/tinkoff_base.html" %}

{% block title %}Расходы{% endblock %}

{% block head %}
    <!-- Календарь -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/ru.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!--Изменяемые столбцы -->
    <script src="https://cdn.jsdelivr.net/gh/dobtco/jquery-resizable-columns@0.2.3/dist/jquery.resizableColumns.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/dobtco/jquery-resizable-columns@0.2.3/dist/jquery.resizableColumns.css">

    <!--Выпадающие списки в таблице -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
{% endblock %}


{% block content %}
    <h1>Ваши расходы</h1>
    <h2 id="totalExpenses">Общая сумма расходов: 0 ₽</h2>
    <h2 id="totalIncome">Общая сумма доходов: 0 ₽</h2>

    <!-- Выпадающий список для выбора периода -->
    <div style="position: relative;">
        <button id="periodButton" onclick="togglePeriodOptions()">Этот месяц</button>
        <div id="periodOptions" class="period-options">
            <button onclick="loadDayExpenses(); setPeriodLabel('Сегодня')">Сегодня</button>
            <button onclick="loadExpensesByDefaultPeriod('week'); setPeriodLabel('Текущая неделя')">Текущая неделя</button>
            <button onclick="loadExpensesByDefaultPeriod('month'); setPeriodLabel('Этот месяц')">Этот месяц</button>
            <button onclick="loadExpensesByDefaultPeriod('3month'); setPeriodLabel('3 месяца')">3 месяца</button>
            <button onclick="loadExpensesByDefaultPeriod('year'); setPeriodLabel('Этот год')">Этот год</button>
        </div>
    </div>

    <div style="margin-top: 15px;">
        <label for="dateRange">Выберите период:</label>
        <input id="dateRange" type="text" placeholder="Выберите период" />
    </div>

    <table id="expensesTable" class="expenses-table resizable">
        <thead>
            <tr>
                <th>Дата и время операции</th>
                <th>Карта</th>
                <th>Тип операции</th>
                <th>Сумма</th>
                <th>Описание</th>
                <th>Статья</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- Модальное окно для добавления категории -->
    <div id="addCategoryModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addCategoryModal')">&times;</span>
            <p>Внести новую статью?</p>
            <input id="newCategoryInput" type="text" placeholder="Название новой статьи"/>
            <button onclick="submitNewCategory()">Да</button>
            <button onclick="closeModal('addCategoryModal')">Нет</button>
        </div>
    </div>

    <!-- Модальное окно для подтверждения удаления -->
    <div id="deleteCategoryModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal('deleteCategoryModal')">&times;</span>
            <p id="deleteCategoryText">Удалить статью?</p>
            <button onclick="confirmDeleteCategory()">Да</button>
            <button onclick="closeModal('deleteCategoryModal')">Нет</button>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script src="/static/scripts/tinkoff/expenses.js" defer></script>
    <script src="/static/scripts/tinkoff/expenses_calendar.js" defer></script>
    <script src="/static/scripts/tinkoff/expenses_modal.js" defer></script>
{% endblock %}